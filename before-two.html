<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Scatterplot</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #d4f8d4;
        }
        svg {
            border: 1px solid black;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid black;
            font-size: 14px;
            pointer-events: none;
            visibility: hidden;
        }
        .controls {
            margin-bottom: 10px;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
        }
    </style>
</head>
<body>
    <h2>Pokémon Scatterplot</h2>
    <div class="controls">
        <label for="x-axis">X-Axis:</label>
        <select id="x-axis">
            <option value="hp">HP</option>
            <option value="attack">Attack</option>
            <option value="defense">Defense</option>
            <option value="sp_attack">Sp. Attack</option>
            <option value="sp_defense">Sp. Defense</option>
            <option value="speed">Speed</option>
        </select>

        <label for="y-axis">Y-Axis:</label>
        <select id="y-axis">
            <option value="hp">HP</option>
            <option value="attack">Attack</option>
            <option value="defense" selected>Defense</option>
            <option value="sp_attack">Sp. Attack</option>
            <option value="sp_defense">Sp. Defense</option>
            <option value="speed">Speed</option>
        </select>
    </div>

    <svg width="600" height="500"></svg>
    <div class="tooltip"></div>
    <div class="legend"></div>

    <script>
        const margin = { top: 40, right: 30, bottom: 50, left: 50 };
        const width = 600 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;

        const svg = d3.select("svg")
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const tooltip = d3.select(".tooltip");

        const typeColors = {
            normal: "#A8A77A", fire: "#EE8130", water: "#6390F0", electric: "#F7D02C",
            grass: "#7AC74C", ice: "#96D9D6", fighting: "#C22E28", poison: "#A33EA1",
            ground: "#E2BF65", flying: "#A98FF3", psychic: "#F95587", bug: "#A6B91A",
            rock: "#B6A136", ghost: "#735797", dragon: "#6F35FC", dark: "#705746",
            steel: "#B7B7CE", fairy: "#D685AD"
        };

        let data, xAttribute = "hp", yAttribute = "defense";

        d3.csv("post-process-data/pokemon_dataset.csv").then(loadedData => {
            data = loadedData.map(d => ({
                name: d.name,
                classfication: d.classfication,
                type1: d.type1.toLowerCase(),
                hp: +d.hp,
                attack: +d.attack,
                defense: +d.defense,
                sp_attack: +d.sp_attack,
                sp_defense: +d.sp_defense,
                speed: +d.speed
            }));

            createLegend();
            updateScatterplot();
        });

        function createLegend() {
            const legendContainer = d3.select(".legend");
            legendContainer.html(""); 

            Object.entries(typeColors).forEach(([type, color]) => {
                legendContainer.append("div")
                    .attr("class", "legend-item")
                    .html(`<span class="legend-color" style="background-color: ${color};"></span>${type}`);
            });
        }

        

        function updateScatterplot() {
            svg.selectAll("*").remove();

            const xScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => d[xAttribute])])
                .range([0, width]);

            const yScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => d[yAttribute])])
                .range([height, 0]);

            const xAxis = d3.axisBottom(xScale);
            const yAxis = d3.axisLeft(yScale);

            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(xAxis)
                .append("text")
                .attr("x", width / 2)
                .attr("y", 40)
                .attr("fill", "black")
                .attr("text-anchor", "middle")
                .text(xAttribute.toUpperCase());

            svg.append("g")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -40)
                .attr("fill", "black")
                .attr("text-anchor", "middle")
                .text(yAttribute.toUpperCase());

            svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", d => xScale(d[xAttribute]))
                .attr("cy", d => yScale(d[yAttribute]))
                .attr("r", 5)
                .attr("fill", d => typeColors[d.type1] || "gray")
                .attr("opacity", 0.8)
                .on("mouseover", (event, d) => {
            tooltip.style("visibility", "visible")
                .html(`<strong>${d.name}</strong><br><em>${d.classfication}</em><br>${xAttribute.toUpperCase()}: ${d[xAttribute]}<br>${yAttribute.toUpperCase()}: ${d[yAttribute]}`);
        })

                .on("mousemove", event => {
                    tooltip.style("top", (event.pageY + 10) + "px")
                           .style("left", (event.pageX + 10) + "px");
                })
                .on("mouseout", () => {
                    tooltip.style("visibility", "hidden");
                });
        }

        document.getElementById("x-axis").addEventListener("change", function() {
            xAttribute = this.value;
            updateScatterplot();
        });

        document.getElementById("y-axis").addEventListener("change", function() {
            yAttribute = this.value;
            updateScatterplot();
        });

    </script>
</body>
</html>
